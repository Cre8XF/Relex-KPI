<!DOCTYPE html>
<html lang="no" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Relex Focus – produkter å se på</title>
    <link rel="stylesheet" href="styles.css">
  <script>(function () {
      var KEY = 'relexTheme';
      // Valgfritt: overstyr med ?theme=light|dark
      var q = new URLSearchParams(location.search).get('theme');
      var initial =
        (q === 'light' || q === 'dark') ? q :
          (localStorage.getItem(KEY) ||
            document.documentElement.getAttribute('data-theme') ||
            'dark'); // ← default endret til dark
      document.documentElement.setAttribute('data-theme', initial);
      localStorage.setItem(KEY, initial);
    })();</script>
  </head>

  <body>
    <header class="row">
      <h1>Relex Focus</h1>
      <div id="drop" class="drop" tabindex="0" title="Klikk for å velge fil eller dra-og-slipp hit">
        Dra-og-slipp Relex-eksport (CSV eller HTML) hit – eller klikk
        <input id="file" type="file" accept=".csv,.html,.htm,text/csv,text/html" style="display: none" />
      </div>

      <div class="card">
        <div class="row" style="gap: 8px">
          <div>
            <label>Maks. hylle-servicegrad (%)</label><br />
            <input id="maxAvail" type="number" step="0.1" value="" title="Maksimal hylle-servicegrad i prosent" placeholder="f.eks. 98.5" />
          </div>
          <div>
            <label>Min. salgsverdi (kr)</label><br />
            <input id="minSales" type="number" step="1000" value="" title="Minimum salgsverdi i kroner" placeholder="f.eks. 10000" />
          </div>
          <div>
            <label>ABC filter</label><br />
            <select id="abc" title="ABC filter">
              <option value="">Alle</option>
              <option>A</option>
              <option>B</option>
              <option>C</option>
              <option>#</option>
            </select>
          </div>
          <div>
            <label>XYZ filter</label><br />
            <select id="xyz" title="XYZ filter">
              <option value="">Alle</option>
              <option>X</option>
              <option>Y</option>
              <option>Z</option>
              <option>#</option>
            </select>
          </div>
          <div>
            <label>Søk (navn/kode/lev.)</label><br />
            <input id="q" type="search" placeholder="f.eks. H7, kabel, 7400…, EXIDE, SE1-7270150" />
          </div>
          <div>
            <label>Kriterier</label><br />
            <select id="mode" title="Kriterier">
              <option value="both">Begge (lav hylle OG høy salg)</option>
              <option value="either">Minst ett (lav hylle ELLER høy salg)</option>
              <option value="hylle">Kun lav hylle</option>
              <option value="salg">Kun høy salg</option>
            </select>
          </div>

          <!-- NYTT: Lokasjonsfilter -->
          <div>
            <label>Lokasjon (fra Lev.kode)</label><br />
            <select id="region" title="Lokasjon (fra Lev.kode)">
              <option value="">Alle</option>
              <option value="NO2">Vestby (NO2-)</option>
              <option value="SE1">Örebro (SE1-)</option>
              <option value="OTHER">Andre/ukjent</option>
            </select>
          </div>

          <div class="right">
            <label>&nbsp;</label><br />
            <button id="btnExport" class="btn" disabled>Eksporter utsnitt (CSV)</button>
          </div>
          <div>
            <label>Tema</label><br />
            <button id="themeToggle" class="btn secondary" type="button" title="Bytt mellom mørkt og lyst">☀️ Lys</button>
          </div>
        </div>
      </div>
    </header>

    <main style="padding: 12px 16px">
      <!-- KPI-er -->
      <div class="kpi">
        <div class="card">
          <div class="muted">Rader (totalt)</div>
          <div id="kTotal" style="font-size: 20px">–</div>
        </div>
        <div class="card">
          <div class="muted">Rader (filtrert)</div>
          <div id="kShown" style="font-size: 20px">–</div>
        </div>
        <div class="card">
          <div class="muted">Snitt servicegrad (filtrert)</div>
          <div id="kAvgA" style="font-size: 20px">–</div>
        </div>
        <div class="card">
          <div class="muted">Snitt lageromløp (filtrert)</div>
          <div id="kAvgT" style="font-size: 20px">–</div>
        </div>
        <div class="card">
          <div class="muted">Sum salgsverdi (filtrert)</div>
          <div id="kSumS" style="font-size: 20px">–</div>
        </div>
      </div>

      <!-- Leverandør-pivot -->
      <div class="pivotHeader">
        <strong>Leverandører (pivot)</strong>
        <label for="pivotScope" class="visually-hidden">Pivotgrunnlag</label>
        <select id="pivotScope" title="Velg pivotgrunnlag">
          <option value="filtered">Pivotgrunnlag: Kun filtrerte</option>
          <option value="all">Pivotgrunnlag: Alle produkter</option>
        </select>
        <input id="pivotQ" type="search" placeholder="Søk leverandørnavn / -kode" />
        <div class="chipFilter" id="supplierChip" hidden>
          <span class="chipBtn"><strong>Filter:</strong> <span id="supplierLabel"></span></span>
          <button id="clearSupplier" class="btn secondary" type="button">Fjern filter</button>
        </div>
      </div>
      <div class="card fit" id="pivotCard">
        <table id="tblPivot">
          <thead>
            <tr>
              <th class="clickable" data-k="SuppName">Leverandør</th>
              <th class="clickable" data-k="SuppCode">Lev.kode</th>
              <th class="clickable" data-k="count">Produkter</th>
              <th class="clickable" data-k="avgAvail">Snitt hylle-%</th>
              <th class="clickable" data-k="avgTurns">Snitt omløp</th>
              <th class="clickable" data-k="sumSales">Sum salg</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="hint">Klikk på en leverandør for å vise produktene under.</div>
      </div>

      <!-- Ingen treff / kolonnekart -->
      <details class="help" id="help" hidden>
        <summary>Ingen treff? Klikk for tips / kolonnekart</summary>
        <div style="margin-top: 8px">
          <p class="muted">
            Hvis filtrene er for strenge, prøv f.eks. <b>Maks hylle=100</b> og <b>Min salg=0</b>, sett <b>Kriterier=Minst ett</b>. Hvis det fortsatt er 0 rader – velg kolonner manuelt under:
          </p>
          <div class="card">
            <div class="row" style="gap: 10px">
              <div><label>Leverandørnavn</label><br /><select id="mapSuppName"></select></div>
              <div><label>Leverandørkode</label><br /><select id="mapSuppCode"></select></div>
              <div><label>Hylle% (kolonne)</label><br /><select id="mapAvail"></select></div>
              <div><label>Salgsverdi (kolonne)</label><br /><select id="mapSales"></select></div>
              <div><label>Lageromløp</label><br /><select id="mapTurns"></select></div>
              <div><label>Beholdningsverdi</label><br /><select id="mapStock"></select></div>
              <div><label>ABC</label><br /><select id="mapABC"></select></div>
              <div><label>XYZ</label><br /><select id="mapXYZ"></select></div>
            </div>
            <div class="muted" style="margin-top: 6px">Valget lagres lokalt (nettleser) per filtype, så du slipper å velge neste gang.</div>
            <div style="align-self: end; display: flex; gap: 8px">
              <button class="btn" id="saveMap">Lagre kart</button>
              <button class="btn secondary" id="resetMap">Nullstill kart</button>
            </div>
          </div>
        </div>
      </details>

      <!-- Produkt-tabell -->
      <div class="card fit" style="margin-top: 12px">
        <table id="tbl">
          <thead>
            <tr></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="hint">Tips: Klikk på kolonne-overskrifter for å sortere.</div>
      </div>
    </main>
<script src="main.js"></script>

  </body>
</html>
